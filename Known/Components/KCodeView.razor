@inherits BaseComponent

<ReloadContainer @ref="container">
    <pre class="highlight kui-code @Class">
        <code class="language-@Lang">@Code</code>
    </pre>
</ReloadContainer>

@code {
    private ReloadContainer container;
    private bool shouldHighlight;
    private string originalCode;

    /// <summary>
    /// 取得或设置样式类。
    /// </summary>
    [Parameter] public string Class { get; set; }

    /// <summary>
    /// 取得或设置代码。
    /// </summary>
    [Parameter] public string Code { get; set; }

    /// <summary>
    /// 取得或设置代码语言。
    /// </summary>
    [Parameter] public string Lang { get; set; }

    /// <inheritdoc />
    protected override async Task OnInitAsync()
    {
        await base.OnInitAsync();
        originalCode = Code;
    }

    /// <inheritdoc />
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        if (firstRender || shouldHighlight)
        {
            shouldHighlight = false;
            await JSRuntime.HighlightAllAsync();
        }
    }

    /// <summary>
    /// 设置代码。
    /// </summary>
    /// <param name="code">代码。</param>
    public void SetCode(string code)
    {
        if (originalCode == code)
            return;

        originalCode = code;
        Code = code;
        shouldHighlight = true;
        container?.ReloadPage();
    }
}
@inherits BaseLayout

<LayoutValue Value="this" IsFixed>
    @if (Context.IsMobileApp)
    {
        <AppLayout>@ChildContent</AppLayout>
    }
    else
    {
        @ChildContent
    }
    @if (showSpin)
    {
        <Spin Tip="@spinTip" />
    }
</LayoutValue>

@code {
    private string spinTip = "";
    private bool showSpin = false;

    /// <summary>
    /// 取得或设置子组件内容。
    /// </summary>
    [Parameter] public RenderFragment ChildContent { get; set; }

    [Parameter] public Action OnReloadPage { get; set; }
    [Parameter] public Action OnLoadMenus { get; set; }
    [Parameter] public Action<bool> OnToggleSide { get; set; }

    /// <inheritdoc />
    public override async Task ShowSpinAsync(string text, Func<Task> action)
    {
        if (action == null)
            return;

        showSpin = true;
        spinTip = text;
        await StateChangedAsync();
        await Task.Run(async () =>
        {
            try
            {
                await action?.Invoke();
            }
            catch (Exception ex)
            {
                await OnErrorAsync(ex);
            }
            showSpin = false;
            await StateChangedAsync();
        });
    }

    /// <inheritdoc />
    public override void ReloadPage()
    {
        OnReloadPage?.Invoke();
    }

    internal override void LoadMenus()
    {
        OnLoadMenus?.Invoke();
    }

    internal override void ToggleSide(bool collapsed)
    {
        OnToggleSide?.Invoke(collapsed);
    }
}
function log(n){console.log(n)}function loginByToken(n){$.post("/signToken",{token:n},function(n){n.IsValid?location="/":$("#app").html(n.Message)})}function registerWorker(){navigator.serviceWorker&&navigator.serviceWorker.register("service-worker.js")}function initDropdown(){$(".dropdown .title").on("mouseenter",function(){$(this).find(".arrow").removeClass("fa-caret-down").addClass("fa-caret-up");$(this).next().show()});$(".dropdown").on("mouseleave",function(){var n=$(this).find(".title");n.find(".arrow").removeClass("fa-caret-up").addClass("fa-caret-down");n.next().hide()})}function WsUtil(){var n=null,i=!1,t=this;this.connectById=function(n,t,i){window[n]={};this.connect(baseUrl+"/ws?id="+n,t,function(n){if(n&&n.length){var t=JSON.parse(n);i&&i(t)}})};this.connect=function(r,u,f){return r=WsUtil.getUrl(r,u),log(Language.Connecting+"......"),n=new WebSocket(r),n.onopen=function(){log(Language.ClientConnected)},n.onmessage=function(n){n.data&&f&&f(n.data)},n.onclose=function(){i||(log(Language.ClientDisconnected),t.connect(r,u,f))},n.onerror=function(n){log(n);t.close()},window.onbeforeunload=function(){t.close()},n};this.send=function(t){n&&n.send(t)};this.close=function(){i=!0;n&&(n.close(),n=null,log(Language.ClientClosed))}}function Chart(n){Chart.isLoad||(Utils.addJs("/libs/echarts.min.js"),Chart.isLoad=!0);var t=echarts.init(document.getElementById(n));this.clear=function(){t.clear()};this.setOption=function(n){t.setOption(n)};this.setLine=function(n){t.setOption(n)};this.setPie=function(n){t.setOption(n)}}function Error(n){function i(n){var i=t.title,r=t.content;t.title||(i=Language.Error500Title,r=Language.Error500Content,t.type==="403"?(i=Language.Error403Title,r=Language.Error403Content):t.type==="404"&&(i=Language.Error404Title,r=Language.Error404Content));$("<h1>").html(t.type).appendTo(n);$("<h3>").html(i).appendTo(n);$("<div>").html(r).appendTo(n)}var t=n||{};this.render=function(){$(".topbar").hide();$("#app .router").css({top:0});var n=$("<div>").addClass("error-box");return i(n),n}}function Form(n,t){function o(){var t,n,u;e={};r=[];f.html("");t=i.toolbar&&i.toolbar.length;n=t?$("<div>").addClass("form-content").appendTo(f):f;i.tips&&$("<div>").addClass("form-tips").html(i.tips).appendTo(n);i.fields&&(n.addClass(i.type||"form"),l(n,i.fields));t&&(u=$("<div>").addClass("form-button").appendTo(f),c(u))}function c(n){for(var r,t=0;t<i.toolbar.length;t++)r=i.toolbar[t],n.append(Utils.createButton(r,{form:u}))}function l(n,t){for(var i,r,o,f=0;f<t.length;f++)(i=t[f],i.visible===undefined||i.visible)&&(i.form=u,i.type==="hidden"?(o=new Input(n,i),h(o)):i.type==="group"?$("<div>").addClass("form-group").html(i.title).appendTo(n):(i.label?e[i.label]?r=e[i.label]:(r=s(n,i),e[i.label]=r):r=s(n,i),o=new Input(r,i),h(o)))}function s(n,t){var f=t.label||t.title,i=$("<div>").addClass("form-item").appendTo(n),u=$("<label>").addClass("form-label").html(f+"：").appendTo(i),r=$("<div>").addClass("form-input").appendTo(i);return t.itemStyle&&i.addClass(t.itemStyle),t.inputStyle&&r.addClass(t.inputStyle),t.required&&u.addClass("required"),t.labelWidth&&u.css({width:t.labelWidth}),t.unit&&$("<span>").addClass("unit").html(t.unit).appendTo(r),r}function h(n){r.push(n);u[n.id]=n}var i=t,f=typeof n=="string"?$("<div>").attr("id","form"+n):n,e={},r=[],u=this;n.length&&o();this.elem=f;this.render=function(){return o(),f};this.validate=function(){for(var t,i=[],n=0;n<r.length;n++)t=r[n],t.validate()||i.push(t);return i.length===0};this.clear=function(){for(var t,n=0;n<r.length;n++)t=r[n],t.clearError(),t.setValue("")};this.getData=function(){for(var t,i={},n=0;n<r.length;n++)t=r[n],i[t.id]=t.getValue();return i};this.setData=function(n){for(var f,e,o,t=0;t<r.length;t++)f=r[t],e=n[f.id],f.setValue(e);o={form:u,data:n};i.setData&&i.setData(o)};this.save=function(n,t){var r,f,e;u.validate()&&(r=u.getData(),i.onSaving&&i.onSaving(r),f={data:JSON.stringify(r)},i.submitData&&(e=i.submitData(),$.extend(f,e)),Ajax.post(n,f,function(n){r.Id=n;u.setData(r);t&&t(r)}))}}function Grid(n){function v(){t.querys&&t.querys.length&&(e=y(t));var n=$("<table>").appendTo(u);o=$("<thead>").appendTo(n);t.columns&&t.columns.length&&a(t.columns);r=$("<tbody>").appendTo(n);t.url&&t.autoQuery===undefined&&l()}function l(){s(Language.Loading+"......","load");$.post(t.url,i.where,function(n){var r=[];$.isArray(n)?r=n:n.IsValid?r=n.Data:s(n.Message,"error");t.setData?(i.data=r,t.setData({grid:i,data:r})):i.setData(r)})}function y(n){var i=$("<div>").addClass("query").appendTo(u),t=new Query(n);return t.render().appendTo(i),t}function a(n){var r,t,i;for(o.html(""),r=$("<tr>").appendTo(o),f=n,h=n.length,t=0;t<n.length;t++)(i=n[t],i.visible===undefined||i.visible)&&$("<th>").html(i.title).appendTo(r)}function p(n){if(i.data=n||[],r.html(""),n&&n.length)for(var t=0;t<n.length;t++)w(n[t]);else s(Language.NoDataFound,"error")}function w(n){for(var t,u,s,h,e=$("<tr>").appendTo(r),o=0;o<f.length;o++)if(t=f[o],t.visible===undefined||t.visible)if(u=$("<td>").appendTo(e),t.format)s=t.format(n,{tr:e,td:u,column:t}),u.append(s);else if(t.actionFormat){s=t.actionFormat(n,{index:o,tr:e,td:u,column:t});u.append(s);e.find("[action]").on("click",function(){var n=$(this).attr("action"),u=$(this).parentsUntil("tbody").last(),t=r.find("tr").index(u),f=i.data[t];c[n]&&c[n].call(this,{grid:i,row:f,index:t})})}else t.field&&(h=n[t.field],u.append(h))}function s(n,t){r.html("");var i=$("<tr>").appendTo(r);$("<td>").attr("colspan",h).addClass(t).html(n).appendTo(i)}var t=n,u=$("<div>").addClass("grid"),f=[],h=0,e,o,r,i=this,c=$.extend({remove:function(n){n.grid.removeRow(n.index)}},n.action||{});this.elem=u;this.columns=f;this.data=[];this.where=t.where||{};this.render=function(){return u.html(""),v(),u};this.setColumns=function(n){a(n)};this.getData=function(){return i.data};this.setData=function(n){p(n)};this.reload=function(n){var t=e?e.getData():{};$.extend(i.where,t,n||{});l()};this.removeRow=function(n){r.find("tr:eq("+n+")").remove();this.data.splice(n,1)}}function Input(n,t){function l(){o=i.id||i.field;s=i.field;var t=i.type;t==="label"?r=$("<div>").addClass("label").appendTo(n):t==="radio"?e(n,i,i.code):t==="checkbox"?e(n,i,i.code):(t==="select"?(r=$("<select>").appendTo(n),e(r,i,i.code)):t==="textarea"?r=$("<textarea>").appendTo(n):(r=$("<input>").attr("type",t).appendTo(n),i.value&&r.attr("value",i.value)),r.attr("id",o),r.attr("name",s),i.placeholder&&r.attr("placeholder",i.placeholder),i.required&&r.attr("required",!0),i.width&&r.css({width:i.width}),i.change&&c(i.change));i.readonly&&h(!0)}function h(n){i.type==="radio"||i.type==="checkbox"?u.find("input").attr("disabled",n):i.type==="select"?r.attr("disabled",n):r.attr("readonly",n)}function a(n,t){$.get(n,function(n){f.setData(n);t&&t(n)})}function e(n,t,i,r){var f,e,u,i,o,s;if((n.html(""),i)&&(i=Utils.getCodes(i),r=r||t.value,i&&i.length)){for(f=[],t.type==="select"&&(e="",e=t.emptyText!==undefined?t.emptyText:Language.PleaseSelect,e!==""&&f.push({Code:"",Name:e})),u=0;u<i.length;u++)f.push(i[u]);for(u=0;u<f.length;u++)u>0&&u%t.lineCount==0&&$("<br>").appendTo(n),i=f[u],i==="-"?$("<br>").appendTo(n):(o=i.Code===""?"":i.Code||i,s=i.Name||o,t.type==="select"?v(n,f[u],o,s,r):y(n,f[u],o,s,t))}}function c(n){r.change(function(){var t=$(this);n&&n({form:i.form,elem:t,value:t.val(),selected:t.find(":selected").data("data")})})}function v(n,t,i,r,u){var f=$("<option>").data("data",t).attr("value",i).html(r).appendTo(n);u&&i===u&&f.attr("selected",!0)}function y(n,t,i,r,u){var f=$("<label>").addClass("form-radio").appendTo(n),e=$("<input>").data("data",t).attr("type",u.type).attr("name",u.field).attr("value",i).appendTo(f),o=u.value;if(o&&i===o&&e.attr("checked",!0),u.onClick)e.on("click",function(){u.onClick($(this).val())});$("<span>").html(r).appendTo(f)}var u=n,i=t,r,o,s,f=this;l();this.elem=r;this.id=o;this.name=s;this.value="";this.validate=function(){f.clearError();var n=$.trim(f.getValue());return r&&!r[0].disabled&&i.required&&n===""?(u.addClass("error"),!1):i.required&&n===""?(u.addClass("error"),!1):!0};this.clearError=function(){u.removeClass("error")};this.getValue=function(){if(i.type==="label")return f.value;if(i.type==="radio")return u.find("input:checked").val()||"";if(i.type==="checkbox"){var n=[];return u.find("input:checked").each(function(t,i){n.push($(i).val())}),n.join(",")}return r.val()};this.setValue=function(n){var o,e,t,s;if(f.value=n,i.type==="label")o=n,i.code&&(o=Utils.getCodeName(i.code,n)),r.html(o);else if(i.type==="radio")for(e=u.find("input"),t=0;t<e.length;t++)e[t].checked=e[t].value===n;else if(i.type==="checkbox")for(e=u.find("input"),t=0;t<e.length;t++)s=e[t].value,e[t].checked=n===1||n===!0||n&&n.indexOf(s)>-1;else r.val(n)};this.setReadonly=function(n){i.type!=="label"&&h(n)};this.setUrl=function(n,t){a(n,t)};this.getData=function(){if(i.type==="select")return r.find(":selected").data("data");var n=[];return u.find("input:checked").each(function(t,i){n.push($(i).data("data"))}),n};this.setData=function(n,t){e(r,i,n,t)};this.change=function(n){c(n)}}function List(n){function o(){if(i=$("<ul>").addClass("list"),t.style&&i.addClass(t.style),t.items){var n=t.items;$.isFunction(t.items)&&(n=t.items());r(n)}}function u(){f("load",Language.Loading+"......")}function s(n,t){u();$.post(n,function(n){$.isArray(n)&&r(n);t&&t(n)})}function r(n){var r,u,o;if(i.html(""),n&&n.length){for(r=0;r<n.length;r++)if(u=n[r],o=$("<li>").data("item",u).appendTo(i),e({el:o,data:u}),u.onClick)o.on("click",function(){var n=$(this).data("item");n.onClick()});else if(t.onClick)o.on("click",function(){var n=$(this).data("item");t.onClick(n)})}else f("error",Language.NoData)}function f(n,t){i.html("");$("<li>").addClass(n).html(t).appendTo(i)}var t=n,i,e=n.template||function(n){$("<span>").addClass("icon").append('<i class="'+n.data.icon+'">').appendTo(n.el);$("<span>").addClass("title").html(n.data.title).appendTo(n.el);n.data.onClick&&$("<span>").addClass("right fa fa-chevron-right").appendTo(n.el)};this.render=function(){return o(),i};this.loading=function(){u()};this.load=function(n,t){s(n,t)};this.setData=function(n){r(n)}}function Menu(n){function r(){i=$("<ul>").addClass("menu");t.items&&u(t.items)}function u(n){for(var e=100/(t.lineCount||2)+"%",u=0;u<n.length;u++){var r=n[u],o=$("<li>").css({width:e}).appendTo(i),f=$("<div>").addClass("inner").appendTo(o);$("<div>").addClass("icon").css({backgroundColor:r.bgColor}).attr("id",r.id).append('<i class="'+r.icon+'">').append('<span class="badge danger">').appendTo(f).data("item",r).on("click",function(){var n=$(this).data("item");app.router.route(n)});$("<div>").addClass("name").html(r.name).appendTo(f)}}var t=n,i;this.render=function(){return r(),i}}function Pager(n){function c(){i=$("<ul>").addClass("pager");s=$("<li>").addClass("pager-prev").html(Language.Previous).appendTo(i).on("click",function(){t.page>1&&u(t.page-1)});f=$("<li>").addClass("pager-info").html("0/0").appendTo(i);h=$("<li>").addClass("pager-next").html(Language.Next).appendTo(i).on("click",function(){t.page<r&&u(t.page+1)})}function l(n){r=Math.ceil(n/o);f.html(t.page+"/"+r)}function u(n){t.page=n;e.onPage(n)}var e=n||{},t=this,o=n.size||10,r=1,i,s,f,h;this.page=1;this.render=function(){return c(),i};this.search=function(){u(1)};this.setData=function(n){l(n)}}function Query(n){function o(){t.querys&&t.querys.length&&s(t.querys)}function s(n){var r,s,h;for(i.html(""),r=0;r<n.length;r++){var t=n[r],f=$("<div>").addClass("query-item").appendTo(i),c=$("<label>").html(t.title+"：").appendTo(f);if(t.labelWidth&&c.css({width:t.labelWidth}),t.type==="dateRange"){var o=new Date,l=new Date(o.getFullYear(),o.getMonth(),o.getDate()-(t.diffDay||7)),a=new Input(f,$.extend({},t,{type:"date",id:"start"+t.field,value:l.format(DateFormat)}));u(a);s=new Input(f,$.extend({},t,{type:"date",id:"end"+t.field,value:o.format(DateFormat)}));u(s)}else h=new Input(f,t),u(h)}Utils.createButton({text:Language.Query,handler:function(){e()}}).appendTo(i.find(".query-item").last())}function u(n){r.push(n);f[n.id]=n}function e(){var n=f.getData();if(t.onSearch)t.onSearch({grid:t.grid,data:n});else t.grid.reload(n)}var t=n,i=$("<div>").addClass("query"),r=[],f=this;this.elem=i;this.render=function(){return o(),i};this.getData=function(){for(var t,i={},n=0;n<r.length;n++)t=r[n],i[t.id]=t.getValue();return i};this.search=function(){e()}}function Router(n,t){function e(){i=u.isTop?$("<div>").addClass("router").appendTo(n):n}var u=t,i,r={},f=this;e();this.elem=i;this.route=function(n){var f=r.component,u;f&&f.destroy&&f.destroy();t.isTop&&(n.previous||(n.previous=r),r=n);u=n.component;u&&(app.topbar.showTop(n.hideTop),t.isTop&&(app.setTool(""),app.topbar.setTitle(n.title||n.name,!n.isTabbar),app.tabbar.showTab(n.isTabbar)),i.html(""),u.render().appendTo(i),setTimeout(function(){u.mounted&&u.mounted()},10))};this.back=function(){f.route(r.previous)}}function Slider(n){function o(){var s,n,o;for(t=$("<div>").addClass("slider"),i.height&&t.css({height:i.height}),n=0;n<i.items.length;n++)o=i.items[n],$("<div>").addClass("slider-item").append('<img src="'+o.img+'">').appendTo(t);for(s=$("<div>").addClass("slider-snk").appendTo(t),n=0;n<i.items.length;n++)o=i.items[n],$("<span>").appendTo(s);f(r);u=setInterval(function(){r++;r===i.items.length&&(r=0);f(r)},e)}function f(n){t.find(".slider-item").removeClass("active fadeIn animated");t.find(".slider-item:eq("+n+")").addClass("active fadeIn animated");t.find(".slider-snk span").removeClass("active");t.find(".slider-snk span:eq("+n+")").addClass("active")}var i=n,t,u,e=n.interval||3e3,r=0;this.render=function(){return o(),t};this.destroy=function(){clearInterval(u)}}function Tabbar(n,t){function e(){i=$("<div>").addClass("tabbar").appendTo(n);r.data&&u(r.data)}function u(n){for(var t,u,e=100/n.length+"%",r=0;r<n.length;r++)t=n[r],t.isTabbar=!0,u=$("<a>").css({width:e}).attr("id",t.id).data("item",t).appendTo(i).on("click",function(){var n=$(this).data("item");f($(this),n)}),$("<div>").addClass("icon").append('<i class="'+t.icon+'">').append('<span class="badge danger">').appendTo(u),$("<div>").addClass("name").html(t.name).appendTo(u);f(i.find("a:eq(0)"),n[0])}function f(n,t){i.find("a").removeClass("active");n.addClass("active");app.route(t)}var r=t,i;e();this.elem=i;this.setData=function(n){u(n)};this.showTab=function(n){n?(app.router.elem.css({bottom:"50px"}),i.show()):(app.router.elem.css({bottom:0}),i.hide())}}function Tabs(n){function o(){i=$("<div>").addClass("tabs");r=$("<ul>").addClass("tabs-header").appendTo(i);u=$("<div>").addClass("tabs-content").appendTo(i);t.singleTab&&(f=new Router(u,{}));t.items&&s(t.items)}function s(n){for(var i,u=100/n.length+"%",t=0;t<n.length;t++){i=n[t];i.index=t;$("<li>").css({width:u}).append(i.name).appendTo(r).data("item",i).on("click",function(){var n=$(this).data("item");e($(this),n)})}e(r.find("li:eq(0)"),n[0])}function e(n,i){if(r.find("li").removeClass("active"),n.addClass("active"),t.singleTab)f.route(i);else{var s=i.index||0,o="tab-"+s,e=$("#"+o);e.length||(e=$("<div>").addClass("tabs-item").attr("id",o).appendTo(u),new Router(e,{}).route(i));$(".tabs-item",u).removeClass("active");e.addClass("active")}t.onItemClick&&t.onItemClick(i)}var t=n||{},i,r,u,f;this.render=function(){return o(),i}}function Topbar(n,t){function r(){i=$("<div>").addClass("topbar").appendTo(n)}var u=t,i;r();this.elem=i;this.setTitle=function(n,t){var r=i.find(".fa-chevron-left"),u;r.length||(r=$("<i>").addClass("fa fa-chevron-left").appendTo(i).on("click",function(){app.router.back()}));t?r.show():r.hide();u=i.find(".title");u.length||(u=$("<span>").addClass("title").appendTo(i));u.html(n)};this.showTop=function(n){n?(app.router.elem.css({top:0}),i.css({backgroundColor:"transparent"})):(app.router.elem.css({top:"50px"}),i.css({backgroundColor:"#428bca"}))};this.setTool=function(n){var t=i.find(".topbar-tool");t.length||(t=$("<div>").addClass("topbar-tool").appendTo(i));t.html("");n.length&&n.appendTo(t)}}function SysChangePwd(){var t={UpdatePassword:baseUrl+"/Home/UpdatePassword"},n,i=[{title:Language.CurrentPassword,field:"OldPassword",type:"password",required:!0},{title:Language.NewPassword,field:"NewPassword",type:"password",required:!0},{title:Language.NewPassword1,field:"NewPassword1",type:"password",required:!0}],r=[{icon:"fa fa-save",text:Language.ConfirmUpdate,handler:function(){n.save(t.UpdatePassword,function(){app.router.back()})}}];this.render=function(){var t=$("<div>").addClass("content").css({padding:"20px"}),u=$("<div>").addClass("form").appendTo(t);return n=new Form(u,{fields:i,toolbar:r}),t}}function SysUser(){function t(n){var t=$("<div>").addClass("btnLogout").appendTo(n);$("<button>").addClass("danger").html(Language.SafeLogout).appendTo(t).click(function(){app.logout()})}var n=new List({style:"info",items:function(){return[{icon:"fa fa-user",title:app.user.Name+"("+app.user.UserName+")"},{icon:"fa fa-mobile",title:app.user.Mobile},{icon:"fa fa-envelope-o",title:app.user.Email},{icon:"fa fa-university",title:app.user.OrgName||app.user.CompName},{icon:"fa fa-lock",title:Language.UpdatePassword,onClick:function(){app.route({name:Language.UpdatePassword,component:new SysChangePwd(app.user)})}}]}});this.render=function(){var i=$("<div>").addClass("content user"),r=$("<div>").addClass("avatar").appendTo(i);return $("<img>").attr("src",staticUrl+app.user.AvatarUrl).appendTo(r),n.render().appendTo(i),t(i),i}}function Login(){function r(n){$("<h1>").html($("title").text()).appendTo(n)}function u(t){n(t,"userName","text","fa fa-user",Language.UserName,'$("#password").focus();');var i=showCaptcha?'$("#captcha").focus();':'$("#btnLogin").click();';n(t,"password","password","fa fa-lock",Language.Password,i);showCaptcha&&f(t);$("<button>").attr("id","btnLogin").html(Language.Login).appendTo(t).on("click",function(){o($(this))});$("<div>").attr("id","message").addClass("message").appendTo(t)}function n(n,t,i,r,u,f){var e=$("<div>").addClass("form-item").appendTo(n);return $("<label>").addClass(r).attr("for",t).appendTo(e),$("<input>").attr("type",i).attr("id",t).attr("placeholder",u).attr("autocomplete","off").attr("onenter",f).appendTo(e),e}function f(t){var i=n(t,"captcha","text","fa fa-check-circle-o",Language.Captcha,'$("#btnLogin").click();');$("<img>").attr("id","imgCaptcha").attr("src",baseUrl+"/Home/GetCaptcha").attr("title",Language.RefreshCaptcha).attr("alt","").appendTo(i).on("click",function(){var n=$(this),t=n.attr("src").split("?")[0];n.attr("src",t+"?rnd="+Math.random())})}function e(n){var t=$("<div>").addClass("footer").appendTo(n);$("<p>").addClass("copyright").append(copyrightInfo).appendTo(t)}function o(n){var e,o;$(".form-item").removeClass("error");var r=t("userName"),u=t("password"),f=t("captcha");r===""||u===""||showCaptcha&&f===""||(e=n.html(),o=n.attr("disabled",!0).html(Language.Logining),$.post(baseUrl+"/signin",{userName:r,password:u,captcha:f,isMobile:!0},function(n){o.removeAttr("disabled").html(e);n.IsValid?(i("#fff",n.Message),curUser=n.Data.User,Utils.setUser(curUser),location.reload()):i("#f00",n.Message)}))}function t(n){var t=$("#"+n),i=$.trim(t.val());return i===""&&t.parent().addClass("error"),i}function i(n,t){$("#message").css("color",n).html(t)}this.render=function(){$(".topbar").hide();$("#app .router").css({top:0});var n=$("<div>").addClass("login"),t=$("<div>").addClass("form").appendTo(n);return r(t),u(t),e(n),n};this.mounted=function(){$("#userName").focus()}}function App(n,t){function s(){i.html("");e.showTopbar&&(r=new Topbar(i,{}));u=new Router(i,{isTop:!0});e.showTabbar&&(f=new Tabbar(i,{}))}var e=t,i=$("#"+n),r,u,f,o=this;s();this.elem=i;this.topbar=r;this.router=u;this.tabbar=f;this.user={};this.setTool=function(n){r.setTool(n)};this.setTabbar=function(n){f.setData(n)};this.route=function(n){u.route(n)};this.login=function(){this.route({component:new Login})};this.error=function(n){this.route({component:new Error({type:n})})};this.logout=function(){Layer.confirm(Language.LogoutConfirm,function(){$.post(baseUrl+"/signout",function(){Utils.setUser(null);Utils.setCodes(null);app.login()})})};this.loadUser=function(n,t){$.get(n,function(n){if(n.timeout){app.login();return}o.user=n.user;Utils.setUser(n.user);Utils.setCodes(n.codes);t&&t(n)})}}var Layer,copyrightInfo,app;const DateFormat="yyyy-MM-dd",DateTimeFormat="yyyy-MM-dd HH:mm:ss";Date.prototype.format=function(n){var i={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()},t;/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(t in i)new RegExp("("+t+")").test(n)&&(n=n.replace(RegExp.$1,RegExp.$1.length===1?i[t]:("00"+i[t]).substr((""+i[t]).length)));return n};WsUtil.getUrl=function(n,t){var i,r,u;if(n.indexOf("ws://")>-1||n.indexOf("wss://")>-1||(i=location.protocol==="https:"?"wss://":"ws://",n.indexOf(location.host)<0&&(i+=location.host),n=i+n),t){n+=n.indexOf("?")<0?"?":"&";r=[];for(u in t)r.push(u+"="+t[u]);n+=r.join("&")}return n};var Utils={getUrlParam:function(n){var i=new RegExp("(^|&)"+n+"=([^&]*)(&|$)","i"),t=window.location.search.substr(1).match(i);return t==null?"":decodeURI(t[2])},getClientId:function(){var r=function(n){var t="";for(i=0;i<n.length;i++)t+=u(n.charCodeAt(i));return t},u=function(n){for(var t=n.toString(16),i=0;i+t.length<4;)t="0"+t,i++;return t},t=document.createElement("canvas"),n=t.getContext("2d");n.font="14px Arial";n.fillStyle="#ccc";n.fillText("Known_Client",2,2);var f=t.toDataURL().replace("data:image/png;base64,",""),e=window.atob(f);return r(e.slice(-16,-12))},addCss:function(n){var i=document.createElement("link"),t;i.rel="stylesheet";t=$('link[href*="static/libs/"]');t.length||(t=$('link[href*="static/"]'));t.length?i.href=baseUrl+"/static"+n:(t=$('link[href*="libs/"]'),t.length||(t=$('link[href*="css/"]')),i.href=baseUrl+n);t.last().after($(i))},addJs:function(n){var i=document.createElement("script"),t=$('script[src*="static/libs/"]');t.length||(t=$('script[src*="static/"]'));t.length?i.src=baseUrl+"/static"+n:(t=$('script[src*="libs/"]'),t.length||(t=$('script[src*="js/"]')),i.src=baseUrl+n);t.last().after($(i))},loadJs:function(n){window.onload=function(){var t=document.createElement("script");t.src=n;document.body.appendChild(t)}},format:function(n,t){return arguments.length==1?function(){var t=$.makeArray(arguments);return t.unshift(n),$.format.apply(this,t)}:(arguments.length>2&&t.constructor!=Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!=Array&&(t=[t]),$.each(t,function(t,i){n=n.replace(new RegExp("\\{"+t+"\\}","g"),i)}),n)},copy:function(n){var t=document.createElement("textarea"),i,r;t.value=n;t.style.position="absolute";t.style.left="-9999px";document.body.appendChild(t);i=document.getSelection();r=i.rangeCount>0?i.getRangeAt(0):!1;t.select();document.execCommand("copy");document.body.removeChild(t);r&&(i.removeAllRanges(),i.addRange(r))},paste:function(n,t){n?$(document).bind("paste",function(){if(event.clipboardData||event.originalEvent){var n=event.clipboardData||window.clipboardData,i=n.getData("text");t&&t(i);event.preventDefault()}}):$(document).unbind("paste")},list2Tree:function(n,t){if(!n)return[];let i=n.slice();return i.filter(function(n){let r=i.filter(function(t){return n.id===t.pid});return r.length>0&&(n.children=r),n.pid===t})},tree2List:function(n){if(!n)return[];let i=[],t=n.slice();while(t.length){let r=t.shift();i.push(r);let n=r.children;if(n&&n.length)for(let i=0;i<n.length;i++)t.push(n[i])}return i},getExtIcon:function(n){switch(n){case".pdf":return"fa fa-file-pdf-o pdf";case".doc":case".docx":return"fa fa-file-word-o doc";case".xls":case".xlsx":return"fa fa-file-excel-o xls";case".ppt":case".pptx":return"fa fa-file-powerpoint-o ppt";case".jpg":case".jpeg":case".gif":case".png":case".tif":return"fa fa-file-photo-o";case".rar":case".zip":case".gz":return"fa fa-file-zip-o";default:return"fa fa-file-o"}},keyUser:"Known_User",keyCode:"Known_Codes",setUser:function(n){var t=this.keyUser;n?sessionStorage.setItem(t,JSON.stringify(n)):sessionStorage.removeItem(t)},getUser:function(){var n=sessionStorage.getItem(this.keyUser);return!n||n==="undefined"?null:JSON.parse(n)},setCodes:function(n){var t=this.keyCode;n?localStorage.setItem(t,JSON.stringify(n)):localStorage.removeItem(t)},getCodes:function(n){var i,t,r,u;if(!n)return[];if($.isArray(n))return n;if($.isPlainObject(n)){i=[];for(t in n)i.push({Code:t,Name:t,Data:n[t]});return i}return n==="YesNo"?[{Code:1,Name:Language.Yes},{Code:0,Name:Language.No}]:n==="HasNot"?[{Code:1,Name:Language.Has},{Code:0,Name:Language.Not}]:n==="Enabled"?[{Code:1,Name:Language.Enable},{Code:0,Name:Language.Disable}]:(r=localStorage.getItem(this.keyCode),!r)?[]:(u=JSON.parse(r),!u)?[]:u[n]||[]},getCodeName:function(n,t){var r=this.getCodes(n),f,e,u,i;if(r&&r.length){if(typeof t=="string"&&t.indexOf(",")>0){for(f=t.split(","),e=[],u=0;u<f.length;u++)i=r.filter(function(n){return n.Code===f[u]}),i.length&&e.push(i[0].Name||t);return e.join(",")}if(i=r.filter(function(n){return n.Code===t}),i.length)return i[0].Name||t}return t},getCodeObject:function(n,t){var f={},i=this.getCodes(n),r,u;if(i&&i.length)for(r=0;r<i.length;r++)u=i[r],t&&t.push(u.Name),f[u.Code]=u.Name;return f},genFile:function(n,t){function e(n){for(var i=new ArrayBuffer(n.length),r=new Uint8Array(i),t=0;t!=n.length;++t)r[t]=n.charCodeAt(t)&255;return i}var u=new Blob([e(n)],{type:"application/octet-stream"}),f=URL.createObjectURL(u),r=document.createElement("a"),i;r.href=f;r.download=t||"";window.MouseEvent?i=new MouseEvent("click"):(i=document.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null));r.dispatchEvent(i)},checkMobile:function(){for(var r=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],i=!1,n=0;n<t.length;n++)if(r.indexOf(t[n])>0){i=!0;break}return i},printIframe:null,print:function(n){var t=this.printIframe,i;this.printIframe||(t=this.printIframe=document.createElement("iframe"),document.body.appendChild(t),t.style.display="none");n.url?(t.src=n.url,n.ajax||(t.onload=function(){setTimeout(function(){t.contentWindow.print()},1)})):n.html&&(i=t.contentWindow.document,i.open(),i.write("<title>"+n.title+"<\/title>"),$(document).find("link").filter(function(){return $(this).attr("rel").toLowerCase()==="stylesheet"}).each(function(){i.write('<link rel="stylesheet" href="'+$(this).attr("href")+'">')}),i.write("<style>html,body{overflow:auto;height:auto;}.form-table{padding:0;}<\/style>"),setTimeout(function(){typeof n.html=="function"?i.write(n.html()):i.write(n.html);setTimeout(function(){t.contentWindow.print()},1)},100))},initPCAField:function(n){var t,i;window.PCARegion||this.addJs("/libs/region.js");n.form.Province.setData(window.PCARegion,n.data.Province);n.form.Province.change(function(n){n.form.City.setData(n.selected.Data);n.form.Area&&n.form.Area.setData([])});n.data.Province&&(t=n.form.Province.getData()||{},n.form.City.setData(t.Data,n.data.City));n.form.Area&&(n.form.City.change(function(n){n.form.Area.setData(n.selected.Data)}),n.data.City&&(i=n.form.City.getData()||{},n.form.Area.setData(i.Data,n.data.Area)))},createButton:function(n,t){var i=$("<button>").data("item",n);n.icon&&$("<i>").addClass(n.icon).appendTo(i);n.style&&i.addClass(n.style);$("<span>").html(n.text||n.name).appendTo(i);i.on("click",function(){var n=$(this).data("item"),i;n.handler&&(t&&$.isFunction(t)&&(t=t()),i=$.extend({item:n},t),n.handler.call(this,i))});return i},parseDom:function(n,t,i){typeof t=="function"?t(i):n.append(t)}},Ajax={get:function(n,t,i){var r=Layer.loading(Language.Loading+"......");$.get(n,t,function(n){r.close();n.Message&&Layer.tips(n.Message);n.IsValid?i&&i(n.Data):i&&i(n)})},post:function(n,t,i){var r=Layer.loading(Language.Submitting+"......");$.post(n,t,function(n){r.close();n.IsValid?(Layer.tips(n.Message),i&&i(n.Data)):n.Message?Layer.alert(n.Message):i&&i(n)})},upload:function(n,t,i,r){for(var s=Layer.loading(Language.Uploading+"......"),e=new FormData,u=new XMLHttpRequest,o=document.getElementById(n).files,f=0;f<o.length;f++)e.append("file"+f,o[f],o[f].name);i&&e.append("data",JSON.stringify(i));u.onload=function(){s.close();var n=JSON.parse(u.responseText);n.IsValid?(Layer.tips(n.Message),r&&r(n.Data)):n.Message?Layer.alert(n.Message):r&&r(n)};u.upload.onprogress=function(n){var t=n.loaded,i=n.total};u.open("post",t,!0);u.send(e)},download:function(n,t,i){function o(n){var i=new RegExp("(^| )"+n+"=([^;]*)(;|$)"),t=document.cookie.match(i);return t&&t.length>3?unescape(t[2]):null}function s(){var n=Layer.loading(Language.Downloading+"......"),t=window.setInterval(function(){var r=o(f);r===e&&(window.clearInterval(t),n.close(),i&&i())},1e3)}var f="Known-Download",e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)}),r=$("<form>").attr("method","post").attr("action",n).attr("target","").appendTo("body").hide(),u;if($("<input>").attr("type","hidden").attr("name",f).attr("value",e).appendTo(r),t&&t!==null)for(u in t)$("<input>").attr("type","hidden").attr("name",u).attr("value",t[u]).appendTo(r);r.submit();s()}},Page={complete:function(){initDropdown();$(".tabs-header li").click(function(){var n=$(this).parent().parent(),t=$(this).index();n.find(".tabs-header li").removeClass("active");n.find(".tabs-item").removeClass("active");$(this).addClass("active");n.find(".tabs-item:eq("+t+")").addClass("active")});$('[placeholder="'+DateFormat+'"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd"})});$('[placeholder="yyyy-MM-dd HH:mm"]:not([readonly])').each(function(){$(this).fdatepicker({format:"yyyy-mm-dd hh:ii",pickTime:!0})});$("input[onenter]").keydown(function(n){if((n.keyCode||n.which)===13){n.preventDefault();var t=$(this).attr("onenter");eval(t)}})}},curUser=Utils.getUser();$(document).ajaxSend(function(n,t){t.setRequestHeader("Known-Token",curUser?curUser.Token:"");t.setRequestHeader("Known-Client",Utils.getClientId())});$(document).ajaxComplete(function(n,t){if(t.responseText&&t.responseText.match("^{(.+:.+,*){1,}}$")){var i=JSON.parse(t.responseText);i&&(i.timeout?top.app.login():i.error&&app.route({component:new Error(i)}))}});$(document).contextmenu(function(n){n.preventDefault()});$(function(){initDropdown();$("input[onenter]").keydown(function(n){if((n.keyCode||n.which)===13){n.preventDefault();var t=$(this).attr("onenter");eval(t)}})});Layer={index:1e4,page:function(n){return this._show("page",n)},open:function(n){return n.showMax=n.showMax===undefined?!0:n.showMax,this._show("dialog",n)},loading:function(n){var i,e;if(n=n||"",n==="")return{close:function(){}};var r=this,t=r.index++,u="mask"+t,f="load"+t;return $("<div>").addClass("mask").attr("id",u).css({zIndex:t}).appendTo($("body")),i=$("<div>").addClass("loading").attr("id",f).append('<i class="fa fa-spinner fa-spin fa-1x fa-fw">').append(n),e=i.outerWidth(),i.css({marginLeft:-(e/2)+"px",zIndex:t+1}).appendTo($("body")),{close:function(){$("#"+u+",#"+f).remove();r.index--}}},tips:function(n){var t,i,r;(n=n||"",n!=="")&&(t=$(".tips"),t.length||(t=$("<div>").addClass("tips").css({zIndex:this.index}).appendTo($("body"))),t.html(n),i=t.outerWidth(),r=t.outerHeight(),t.css({marginLeft:-(i/2)+"px",marginTop:-(r/2)+"px"}),setTimeout(function(){t.remove()},3e3))},alert:function(n,t){var i=this,r=56,u=i._show("dialog",{showMax:!1,icon:"fa fa-info-circle",title:Language.Tips,width:300,height:150,content:function(t){var i=$("<div>").css({textAlign:"center",height:r+"px"}).appendTo(t);$("<div>").css("padding-top","15px").html(n).appendTo(i)},footer:function(n){i._createOK(n,function(){t&&t();u.close()})}})},confirm:function(n,t){var i=this,u=56,r=i._show("dialog",{showMax:!1,icon:"fa fa-question-circle",title:Language.Confirm,width:300,height:150,content:function(t){var i=$("<div>").css({textAlign:"center",height:u+"px"}).appendTo(t);$("<div>").css("padding-top","15px").html(n).appendTo(i)},footer:function(n){i._createOK(n,function(){t&&t();r.close()});$("<span>").css({width:"20px",display:"inline-block"}).appendTo(n);i._createCancel(n,function(){r.close()})}})},changeMax:function(n,t,i,r){n.data("isMax")?(n.data("isMax",!1).removeClass("fa-window-restore").addClass("fa-window-maximize"),t.removeClass(i).attr("style",n.data("layerStyle"))):(n.data("isMax",!0).data("layerStyle",t.attr("style")).removeClass("fa-window-maximize").addClass("fa-window-restore"),t.addClass(i).attr("style","").css({zIndex:r}))},_createOK:function(n,t){$("<button>").addClass("ok").html(Language.OK).appendTo(n).on("click",t)},_createCancel:function(n,t){$("<button>").addClass("cancel").html(Language.Cancel).appendTo(n).on("click",t)},_show:function(n,t){function g(n){return $("<i>").addClass("fa fa-window-maximize maximize").data("isMax",!1).appendTo(n).click(function(){o.changeMax($(this),i,"dialog-max",f+1)})}function c(n){$("<i>").addClass("fa fa-close close").appendTo(n).click(w)}function w(){s.close();t.onClose&&t.onClose()}function nt(n){n.mousedown(function(n){n.preventDefault();r.move=!0;r.offset=[n.clientX-parseFloat(i.css("left")),n.clientY-parseFloat(i.css("top"))]});$(document).mousemove(function(n){if(n.preventDefault(),r.move){var t=n.clientX-r.offset[0],u=n.clientY-r.offset[1];i.css({left:t,top:u})}}).mouseup(function(){delete r.move})}function b(n,i){if(t.content)i&&n.css({overflow:"auto"}),k(n,t.content);else if(t.url)t.partial?(i&&n.css({overflow:"auto"}),n.load(t.url)):(i||n.css({padding:0,overflow:"hidden"}),$("<iframe>").attr("frameborder","0").attr("src",t.url).appendTo(n));else if(t.component){var r=new Router(n);r.route(t)}}function tt(n){var i=$("<div>").addClass("dialog-footer");t.footer?(i.appendTo(n),k(i,t.footer)):t.buttons?(i.appendTo(n),$(t.buttons).each(function(n,t){$("<button>").addClass("ok").append(t.text).on("click",function(){t.handler&&t.handler.call(this,s)}).appendTo(i)}),o._createCancel(i,w)):h.css({bottom:0})}function k(n,t){typeof t=="function"?t(n):n.append(t)}var o=this,f=o.index++,y="mask"+f,p="layer"+f,i,s,r,l,a,v,d,u,h,e;return $("<div>").attr("id",y).addClass("mask").css({zIndex:f}).appendTo($("body")),i=$("<div>").attr("id",p).addClass(n).css({zIndex:f+1}).appendTo($("body")),s={index:f,layer:i,close:function(){$("#"+y+",#"+p).remove();o.index--}},r={},n==="dialog"?(l=t.width||500,a=t.height||300,i.css({width:l+"px",height:a+"px",marginTop:-(a/2)+"px",marginLeft:-(l/2)+"px"}),e=$("<div>").addClass("dialog-content").appendTo(i),t.title?(d=t.icon||"fa fa-window-maximize",u=$("<div>").addClass("dialog-header"),$("<i>").addClass("icon "+d).appendTo(u),u.append(t.title),nt(u),t.showMax&&(v=g(u)),c(u),e.append(u)):t.showClose&&c(i),h=$("<div>").addClass("dialog-body").appendTo(e),t.title||h.css({top:0}),b(h,!1),tt(e),t.max&&v&&v.click()):(e=$("<div>").addClass("page-content").appendTo(i),c(i),b(e,!0)),t.success&&t.success(),s}};Chart.isLoad=!1;Form.bind=function(n,t,i){var f,u,r,e,o,s;for(f in t)u=n.find('[name="'+f+'"]'),u.length&&(r=t[f],e=u.attr("placeholder"),e&&(o=r instanceof Date?r:new Date(r),r=o.format(e)),s=u[0].nodeName,"DIV,P,SPAN,TD".indexOf(s)>-1?u.html(r):u.val(r),i&&i({elem:u,value:r,data:t}))};copyrightInfo="&copy;2020-"+(new Date).format("yyyy")+'<a href="http://www.pumantech.com" target="_blank">普漫科技<\/a>';app=new App("app",{showTopbar:!0,showTabbar:!0});